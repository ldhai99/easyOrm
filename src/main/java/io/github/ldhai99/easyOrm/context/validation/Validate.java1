package io.github.ldhai99.easyOrm.context.validation;

import java.util.Collection;
import java.util.function.Supplier;

/**
 * 参数验证工具类
 * 提供参数校验功能，校验失败时抛出异常
 *
 * @author ldhai99
 * @since 1.0
 */
public final class Validate {

    private Validate() {
        throw new UnsupportedOperationException("Utility class cannot be instantiated");
    }

    // ================ 基本验证方法 ================

    /**
     * 验证对象不为null
     *
     * @param obj     要验证的对象
     * @param message 异常信息
     * @throws IllegalArgumentException 如果对象为null
     */
    public static void notNull(Object obj, String message) {
        if (obj == null) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证对象不为null
     *
     * @param obj              要验证的对象
     * @param messageSupplier  异常信息提供者
     * @throws IllegalArgumentException 如果对象为null
     */
    public static void notNull(Object obj, Supplier<String> messageSupplier) {
        if (obj == null) {
            throw new IllegalArgumentException(messageSupplier.get());
        }
    }

    /**
     * 验证对象不为null，使用默认异常信息
     *
     * @param obj     要验证的对象
     * @param paramName 参数名称
     * @throws IllegalArgumentException 如果对象为null
     */
    public static void notNull(Object obj, String paramName, Object... args) {
        if (obj == null) {
            String message = paramName + " must not be null";
            if (args.length > 0) {
                message = String.format(paramName, args);
            }
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证对象不为空
     *
     * @param obj     要验证的对象
     * @param message 异常信息
     * @throws IllegalArgumentException 如果对象为空
     */
    public static void notEmpty(Object obj, String message) {
        if (EmptyCheck.isEmpty(obj)) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证对象不为空
     *
     * @param obj              要验证的对象
     * @param messageSupplier  异常信息提供者
     * @throws IllegalArgumentException 如果对象为空
     */
    public static void notEmpty(Object obj, Supplier<String> messageSupplier) {
        if (EmptyCheck.isEmpty(obj)) {
            throw new IllegalArgumentException(messageSupplier.get());
        }
    }

    /**
     * 验证对象不为空，使用默认异常信息
     *
     * @param obj       要验证的对象
     * @param paramName 参数名称
     * @throws IllegalArgumentException 如果对象为空
     */
    public static void notEmpty(Object obj, String paramName, Object... args) {
        if (EmptyCheck.isEmpty(obj)) {
            String message = paramName + " must not be empty";
            if (args.length > 0) {
                message = String.format(paramName, args);
            }
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证字符串不为空且不全是空白字符
     *
     * @param cs       要验证的字符序列
     * @param message  异常信息
     * @throws IllegalArgumentException 如果字符串为空或全是空白字符
     */
    public static void notBlank(CharSequence cs, String message) {
        if (EmptyCheck.isBlank(cs)) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证字符串不为空且不全是空白字符
     *
     * @param cs               要验证的字符序列
     * @param messageSupplier  异常信息提供者
     * @throws IllegalArgumentException 如果字符串为空或全是空白字符
     */
    public static void notBlank(CharSequence cs, Supplier<String> messageSupplier) {
        if (EmptyCheck.isBlank(cs)) {
            throw new IllegalArgumentException(messageSupplier.get());
        }
    }

    /**
     * 验证字符串不为空且不全是空白字符，使用默认异常信息
     *
     * @param cs         要验证的字符序列
     * @param paramName  参数名称
     * @throws IllegalArgumentException 如果字符串为空或全是空白字符
     */
    public static void notBlank(CharSequence cs, String paramName, Object... args) {
        if (EmptyCheck.isBlank(cs)) {
            String message = paramName + " must not be blank";
            if (args.length > 0) {
                message = String.format(paramName, args);
            }
            throw new IllegalArgumentException(message);
        }
    }

    // ================ 状态验证 ================

    /**
     * 验证条件为true
     *
     * @param condition 条件
     * @param message   异常信息
     * @throws IllegalArgumentException 如果条件为false
     */
    public static void isTrue(boolean condition, String message) {
        if (!condition) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证条件为true
     *
     * @param condition       条件
     * @param messageSupplier 异常信息提供者
     * @throws IllegalArgumentException 如果条件为false
     */
    public static void isTrue(boolean condition, Supplier<String> messageSupplier) {
        if (!condition) {
            throw new IllegalArgumentException(messageSupplier.get());
        }
    }

    /**
     * 验证条件为false
     *
     * @param condition 条件
     * @param message   异常信息
     * @throws IllegalArgumentException 如果条件为true
     */
    public static void isFalse(boolean condition, String message) {
        if (condition) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证条件为false
     *
     * @param condition       条件
     * @param messageSupplier 异常信息提供者
     * @throws IllegalArgumentException 如果条件为true
     */
    public static void isFalse(boolean condition, Supplier<String> messageSupplier) {
        if (condition) {
            throw new IllegalArgumentException(messageSupplier.get());
        }
    }

    // ================ 范围验证 ================

    /**
     * 验证值在指定范围内（包含边界）
     *
     * @param value   要验证的值
     * @param min     最小值
     * @param max     最大值
     * @param message 异常信息
     * @throws IllegalArgumentException 如果值不在范围内
     */
    public static void between(int value, int min, int max, String message) {
        if (value < min || value > max) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证值在指定范围内（包含边界）
     *
     * @param value   要验证的值
     * @param min     最小值
     * @param max     最大值
     * @param message 异常信息
     * @throws IllegalArgumentException 如果值不在范围内
     */
    public static void between(long value, long min, long max, String message) {
        if (value < min || value > max) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证值在指定范围内（包含边界）
     *
     * @param value   要验证的值
     * @param min     最小值
     * @param max     最大值
     * @param message 异常信息
     * @throws IllegalArgumentException 如果值不在范围内
     */
    public static void between(double value, double min, double max, String message) {
        if (value < min || value > max) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证值大于指定最小值
     *
     * @param value   要验证的值
     * @param min     最小值
     * @param message 异常信息
     * @throws IllegalArgumentException 如果值小于等于最小值
     */
    public static void greaterThan(int value, int min, String message) {
        if (value <= min) {
            throw new IllegalArgumentException(message);
        }
    }

    /**
     * 验证值小于指定最大值
     *
     * @param value   要验证的值
     * @param max     最大值
     * @param message 异常信息
     * @throws IllegalArgumentException 如果值大于等于最大值
     */
    public static void lessThan(int value, int max, String message) {
        if (value >= max) {
            throw new IllegalArgumentException(message);
        }
    }

    // ================ 集合验证 ================

    /**
     * 验证集合不为null且不包含null元素
     *
     * @param collection 要验证的集合
     * @param message    异常信息
     * @throws IllegalArgumentException 如果集合为null或包含null元素
     */
    public static void noNullElements(Collection<?> collection, String message) {
        if (collection == null) {
            throw new IllegalArgumentException(message);
        }
        for (Object element : collection) {
            if (element == null) {
                throw new IllegalArgumentException(message);
            }
        }
    }

    /**
     * 验证集合大小在指定范围内
     *
     * @param collection 要验证的集合
     * @param minSize    最小大小
     * @param maxSize    最大大小
     * @param message    异常信息
     * @throws IllegalArgumentException 如果集合大小为null或大小不在范围内
     */
    public static void sizeBetween(Collection<?> collection, int minSize, int maxSize, String message) {
        if (collection == null) {
            throw new IllegalArgumentException(message);
        }
        int size = collection.size();
        if (size < minSize || size > maxSize) {
            throw new IllegalArgumentException(message);
        }
    }

    // ================ 链式验证器 ================

    /**
     * 创建链式验证器
     *
     * @param obj  要验证的对象
     * @param name 对象名称（用于异常信息）
     * @param <T>  对象类型
     * @return 验证器实例
     */
    public static <T> Validator<T> that(T obj, String name) {
        return new Validator<>(obj, name);
    }

    /**
     * 链式验证器
     *
     * @param <T> 对象类型
     */
    public static class Validator<T> {
        private final T obj;
        private final String name;

        private Validator(T obj, String name) {
            this.obj = obj;
            this.name = name;
        }

        /**
         * 验证对象不为null
         *
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果对象为null
         */
        public Validator<T> notNull() {
            Validate.notNull(obj, name + " must not be null");
            return this;
        }

        /**
         * 验证对象不为null（自定义消息）
         *
         * @param message 异常信息
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果对象为null
         */
        public Validator<T> notNull(String message) {
            Validate.notNull(obj, message);
            return this;
        }

        /**
         * 验证对象不为空
         *
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果对象为空
         */
        public Validator<T> notEmpty() {
            Validate.notEmpty(obj, name + " must not be empty");
            return this;
        }

        /**
         * 验证对象不为空（自定义消息）
         *
         * @param message 异常信息
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果对象为空
         */
        public Validator<T> notEmpty(String message) {
            Validate.notEmpty(obj, message);
            return this;
        }

        /**
         * 验证字符串不为空且不全是空白字符
         *
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果字符串为空或全是空白字符
         * @throws ClassCastException 如果对象不是CharSequence
         */
        public Validator<T> notBlank() {
            if (!(obj instanceof CharSequence)) {
                throw new ClassCastException(name + " is not a CharSequence");
            }
            Validate.notBlank((CharSequence) obj, name + " must not be blank");
            return this;
        }

        /**
         * 验证字符串不为空且不全是空白字符（自定义消息）
         *
         * @param message 异常信息
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果字符串为空或全是空白字符
         * @throws ClassCastException 如果对象不是CharSequence
         */
        public Validator<T> notBlank(String message) {
            if (!(obj instanceof CharSequence)) {
                throw new ClassCastException(name + " is not a CharSequence");
            }
            Validate.notBlank((CharSequence) obj, message);
            return this;
        }

        /**
         * 验证自定义条件
         *
         * @param predicate 条件判断函数
         * @param message   异常信息
         * @return 当前验证器实例
         * @throws IllegalArgumentException 如果条件不满足
         */
        public Validator<T> check(java.util.function.Predicate<T> predicate, String message) {
            Validate.isTrue(predicate.test(obj), message);
            return this;
        }

        /**
         * 获取验证后的对象
         *
         * @return 验证后的对象
         */
        public T get() {
            return obj;
        }

        /**
         * 获取验证后的对象，并转换为指定类型
         *
         * @param type 目标类型
         * @param <R>  返回类型
         * @return 验证后的对象
         * @throws ClassCastException 如果对象不能转换为指定类型
         */
        @SuppressWarnings("unchecked")
        public <R> R getAs(Class<R> type) {
            if (obj != null && !type.isInstance(obj)) {
                throw new ClassCastException(name + " is not of type " + type.getName());
            }
            return (R) obj;
        }
    }

    // ================ 自定义异常 ================

    /**
     * 验证失败异常
     */
    public static class ValidationException extends RuntimeException {
        public ValidationException(String message) {
            super(message);
        }

        public ValidationException(String message, Throwable cause) {
            super(message, cause);
        }
    }
}